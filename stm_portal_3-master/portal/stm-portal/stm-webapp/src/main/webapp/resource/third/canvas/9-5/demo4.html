
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link type="text/css"
	href="lib/jquery-ui-1.8.4.custom/css/smoothness/jquery-ui-1.8.4.custom.css"
	rel="stylesheet" />


<script type="text/javascript" src="lib/jquery-ui-1.8.4.custom/js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="lib/jquery-mousewheel-3.1.12/jquery.mousewheel.js"></script>	
<script type="text/javascript" src="lib/raphael.js"></script>
<script type="text/javascript" src="lib/raphael-fn.js"></script>
<script type="text/javascript"
	src="lib/jquery-ui-1.8.4.custom/js/jquery-ui-1.8.4.custom.min.js"></script>
<script type="text/javascript" src="canvas.js"></script>
<script type="text/javascript">
	$(function() {
/**		init($("#myflow")[0],{
							basePath : "",
							//restore : eval("({states:{rect1:{type:'task',text:{text:'服务器B'}, attr:{ x:508, y:157, width:100, height:50}, props:{text:{value:'服务器B'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect2:{type:'task',text:{text:'服务器C'}, attr:{ x:715, y:164, width:100, height:50}, props:{text:{value:'服务器C'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect3:{type:'task',text:{text:'服务器E'}, attr:{ x:304, y:320, width:100, height:50}, props:{text:{value:'服务器E'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect4:{type:'task',text:{text:'服务器F'}, attr:{ x:448, y:318, width:100, height:50}, props:{text:{value:'服务器F'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect5:{type:'task',text:{text:'服务器G'}, attr:{ x:582, y:319, width:100, height:50}, props:{text:{value:'服务器G'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect6:{type:'task',text:{text:'服务器H'}, attr:{ x:709, y:316, width:100, height:50}, props:{text:{value:'服务器H'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect7:{type:'task',text:{text:'服务器I'}, attr:{ x:845, y:317, width:100, height:50}, props:{text:{value:'服务器I'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect8:{type:'task',text:{text:'服务器D'}, attr:{ x:172, y:320, width:100, height:50}, props:{text:{value:'服务器D'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect9:{type:'task',text:{text:'服务器J'}, attr:{ x:976, y:319, width:100, height:50}, props:{text:{value:'服务器J'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect10:{type:'task',text:{text:'服务器K'}, attr:{ x:1156, y:322, width:100, height:50}, props:{text:{value:'服务器K'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect11:{type:'task',text:{text:'服务器A'}, attr:{ x:509, y:39, width:100, height:50}, props:{text:{value:'服务器A'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect12:{type:'task',text:{text:'服务器L'}, attr:{ x:583, y:434, width:100, height:50}, props:{text:{value:'服务器L'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect13:{type:'task',text:{text:'服务器M'}, attr:{ x:420, y:545, width:100, height:50}, props:{text:{value:'服务器M'},assignee:{value:''},form:{value:''},desc:{value:''}}},rect14:{type:'task',text:{text:'服务器N'}, attr:{ x:741, y:543, width:100, height:50}, props:{text:{value:'服务器N'},assignee:{value:''},form:{value:''},desc:{value:''}}}},paths:{path15:{from:'rect11',to:'rect1', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path16:{from:'rect1',to:'rect8', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path17:{from:'rect1',to:'rect3', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path18:{from:'rect1',to:'rect4', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path19:{from:'rect1',to:'rect5', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path20:{from:'rect1',to:'rect6', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path21:{from:'rect1',to:'rect7', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path22:{from:'rect1',to:'rect9', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path23:{from:'rect1',to:'rect10', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path24:{from:'rect2',to:'rect10', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path25:{from:'rect2',to:'rect9', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path26:{from:'rect2',to:'rect7', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path27:{from:'rect2',to:'rect6', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path28:{from:'rect2',to:'rect5', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path29:{from:'rect2',to:'rect4', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path30:{from:'rect2',to:'rect3', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path31:{from:'rect2',to:'rect8', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path32:{from:'rect5',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path33:{from:'rect12',to:'rect13', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path34:{from:'rect12',to:'rect14', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path35:{from:'rect4',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path36:{from:'rect6',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path37:{from:'rect3',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path38:{from:'rect8',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path39:{from:'rect7',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path40:{from:'rect9',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path41:{from:'rect10',to:'rect12', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}}},props:{props:{name:{value:'新建流程'},key:{value:''},desc:{value:''}}}})"),
							restore:eval("({states:{rect1:{type:'start',text:{text:'路由'}, attr:{ x:560, y:99, width:50, height:50}, props:{text:{value:'路由'},temp1:{value:''},temp2:{value:''}}},rect2:{type:'fork',text:{text:'不可用'}, attr:{ x:328, y:204, width:50, height:50}, props:{text:{value:'不可用'},temp1:{value:''},temp2:{value:''}}},rect3:{type:'join',text:{text:'警告'}, attr:{ x:812, y:149, width:50, height:50}, props:{text:{value:'警告'},temp1:{value:''},temp2:{value:''}}},rect4:{type:'state',text:{text:'交换机'}, attr:{ x:392, y:402, width:50, height:50}, props:{text:{value:'交换机'},temp1:{value:''},temp2:{value:''}}},rect5:{type:'task',text:{text:'危险'}, attr:{ x:724, y:355, width:50, height:50}, props:{text:{value:'危险'},assignee:{value:''},form:{value:''},desc:{value:''}}}},paths:{path6:{from:'rect1',to:'rect3', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path7:{from:'rect3',to:'rect5', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path8:{from:'rect5',to:'rect4', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path9:{from:'rect4',to:'rect2', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path10:{from:'rect2',to:'rect1', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path11:{from:'rect4',to:'rect1', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path12:{from:'rect1',to:'rect5', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path13:{from:'rect5',to:'rect2', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path14:{from:'rect2',to:'rect3', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}},path15:{from:'rect3',to:'rect4', dots:[],text:{text:''},textPos:{x:0,y:-10}, props:{text:{value:''}}}},props:{props:{name:{value:'新建流程'},key:{value:''},desc:{value:''}}}})"),
							tools : {
								save : {
									onclick : function(data) {
										alert('save:\n' + data);
									}
								}
							}
						});*/
/**		a = {};
		a.aaa = 23;
		a.bbb = "rfgdg";
		a.ccc = 67890;
		var tt = {abd:"asdfsfs",ioasd:56789}
		var obj = new Object();
		a.obj = obj;
		tt.obj = obj;
		delete tt.obj;
		a.ddd = tt;
		a.ddd.a = 90;
		a[3] = 9;
		delete a["sdsrghf"];
		alert("as length is "+sizeof(a))
		invoke(aaa(1));
		function invoke(a){
			if(a) a();
		}
		function aaa(a){
			alert(a);
		}
		function sizeof(a){
			var s = 0;
			for(var i in a){
				s++;
			}
			return s;
		}
		function Obj(){
			this.id = 0x345678;
			this.f = function(){
				alert(this.id);
			}
			alert("waimian");
		}
		new Obj().f();
		alert(JSON.stringify(a))
		*/
		function sizeof(a){
			var s = 0;
			for(var i in a){
				s++;
			}
			return s;
		}
		//缩略图(要放的DOM元素,width,height,from canvas) BUG:SCROLL(setViewBox,自己拖拽)
		function Tiny($d,c){
			var t = this;
			//可放大最大倍数(图像最小)
			this.maxCoe = 5;
			//可缩小最大倍数(图形最大)
			this.minCoe = .5;
			//变倍的基数
			this.zoomRadix = .1;
			//拖动的块
			this.area = null;
			//缩略图画布
			this.canvas = null;
			var oz = 0;
			this.init = function(){
				this.canvas = $d.canvas();
				this.canvas.isEditable = false;
				this.refresh();
				//设置缩略图最大化
				this.canvas.setViewBox(0,0,this.maxCoe*c.raphael.width,this.maxCoe*c.raphael.height,false);
				c.setViewBox(0,0,c.raphael.width*this.maxCoe,c.raphael.height*this.maxCoe,false);
				$d.dblclick(function(){
					t.refresh();
				})
				$(c.dom).mousewheel(function(event, delta){
					var dir = delta > 0 ? 'Up' : 'Down';
					c.coe -= delta*t.zoomRadix;
					/**当区域100%以上时隐藏缩略图
					if(c.coe>5){
						$d.hide();
					}else{
						$d.show();
					}*/
					if(c.coe>t.maxCoe){
						c.coe = t.maxCoe;						
					}else if(c.coe<t.minCoe){
						c.coe = t.minCoe;					
					}
					//c.setViewBox(0,0,c.raphael.width*c.coe,c.raphael.height*c.coe,false);
					t.zoom(c.coe);	
					return false;
				})							
			}
			this.Area = function(){
				if(this.area) this.area.remove();
				this.area = this.canvas.raphael.rect(0,0,this.maxCoe*c.raphael.width,this.maxCoe*c.raphael.height)
					.attr({stroke:"#000",fill:"#fff","fill-opacity":0}).drag(function(x,y,dx,dy){
						t.move(x,y,dx*t.canvas.coe,dy*t.canvas.coe);
					},function(x,y){
						t.area.rx = x*t.canvas.coe-t.area.attrs.x;
						t.area.ry = y*t.canvas.coe-t.area.attrs.y;
					},function(){
						t.area.rx = 0;
						t.area.ry = 0;
					})
				this.area.rx = this.area.ry = 0;
			}
			this.refresh = function(){
				//refresh from canvas data
				this.canvas.restore(eval("("+c.getData()+")"));
				var lines = this.canvas.lines;
				for(var i in lines){
					lines[i].path.attr({"stroke-width":lines[i].path.attr("stroke-width")/this.maxCoe})
				}
				this.Area();
				//create new drag handler
			}
			this.zoom = function(z){
				if(z<=this.minCoe || z>=this.maxCoe){
					//alert("尺度太大了");
					return;
				}
				this.area.attr({x:this.area.attrs.x+(this.area.attrs.width-c.raphael.width*z)/2,
								y:this.area.attrs.y+(this.area.attrs.height-c.raphael.height*z)/2,
								width:c.raphael.width*z,
								height:c.raphael.height*z})			
				this.move(0,0,this.area.attrs.x,this.area.attrs.y);
				//when mousewhell happend
			}
			this.move = function(dx,dy,x,y){
				var mx = x-this.area.rx,my = y-this.area.ry;
				if(mx<=0){
					mx = 0;
				}else if(mx>=(this.canvas.raphael._viewBox[2]-this.area.attrs.width)){
					mx=this.maxCoe*c.raphael.width-this.area.attrs.width;
				}
				if(my<=0){
					my = 0;
				}else if(my>=(this.canvas.raphael._viewBox[3]-this.area.attrs.height)){
					my = this.maxCoe*c.raphael.height-this.area.attrs.height;
				}
				this.area.attr({x:mx,y:my})
				c.setViewBox(mx,my,c.raphael.width*c.coe,c.raphael.height*c.coe,false);
				//when handler drag,call c's setViewBox
			}					
			this.init();
		}
		
		var containerJSON = {containers:[{x:500,y:350,w:65,h:80,
//			handler:{rx:0,ry:0,w:65,h:50},
			texts:[{text:"192.168.2.12",rx:32.5,ry:75,type:"text_ip",attr:{"stroke":"white"}}],
			imgs:[{src:"img/top/router.png",type:"img_bg",rx:0,ry:0,w:65,h:65}]}]}
		var rest = {"lines":[{"from":"Container4","to":"Container3","ID":"Line9","attr":{"fill":"none","stroke":"white","path":[["M",269,436.7047159699893],["L",293.390243902439,463.5]],"stroke-width":2,"transform":[]}},{"from":"Container3","to":"Container2","ID":"Line10","attr":{"fill":"none","stroke":"white","path":[["M",341.5,503.5],["L",878.5,503.5]],"stroke-width":2,"transform":[]}},{"from":"Container3","to":"Container7","ID":"Line11","attr":{"fill":"none","stroke":"white","path":[["M",341.5,515.487839159082],["L",5792,2525.9406802845156]],"stroke-width":2,"transform":[]}},{"from":"Container7","to":"Container2","ID":"Line12","attr":{"fill":"none","stroke":"white","path":[["M",5792,2524.542354131235],["L",943.5,516.8686312171452]],"stroke-width":2,"transform":[]}},{"from":"Container2","to":"Container6","ID":"Line13","attr":{"fill":"none","stroke":"white","path":[["M",941.2881221737691,543.5],["L",2451.1510125361624,2537.5]],"stroke-width":2,"transform":[]}},{"from":"Container6","to":"Container5","ID":"Line14","attr":{"fill":"none","stroke":"white","path":[["M",2513.3,2556.910030291617],["L",5814,465.7927067082683]],"stroke-width":2,"transform":[]}},{"from":"Container5","to":"Container3","ID":"Line15","attr":{"fill":"none","stroke":"white","path":[["M",5814,445.3433526849266],["L",341.5,503.1586624775583]],"stroke-width":2,"transform":[]}},{"from":"Container4","to":"Container7","ID":"Line16","attr":{"fill":"none","stroke":"white","path":[["M",269,413.42844007055857],["L",5792,2525.49842498425]],"stroke-width":2,"transform":[]}},{"from":"Container7","to":"Container5","ID":"Line17","attr":{"fill":"none","stroke":"white","path":[["M",5824.932550782198,2498],["L",5846.700668896321,485]],"stroke-width":2,"transform":[]}},{"from":"Container5","to":"Container4","ID":"Line18","attr":{"fill":"none","stroke":"white","path":[["M",5814,444.74508948404355],["L",269,401.2534337616305]],"stroke-width":2,"transform":[]}},{"from":"Container4","to":"Container6","ID":"Line19","attr":{"fill":"none","stroke":"white","path":[["M",269,432.5113742623035],["L",2448.3,2545.518695180396]],"stroke-width":2,"transform":[]}},{"from":"Container6","to":"Container3","ID":"Line20","attr":{"fill":"none","stroke":"white","path":[["M",2448.3,2546.4565807641234],["L",341.5,534.0788685750579]],"stroke-width":2,"transform":[]}}],"containers":[{"x":276.5,"y":43.5,"w":710,"h":500,"RX":0,"RY":0,"ID":"Container1","imgs":[],"texts":[{"rx":355,"ry":25,"attr":{"x":631.5,"y":68.5,"text-anchor":"middle","text":"设备管理","font":"10px \"Arial\"","stroke":"none","fill":"white","font-size":18,"transform":[],"stroke-width":1}},{"rx":355,"ry":200,"attr":{"x":631.5,"y":243.5,"text-anchor":"middle","text":"你大爷","font":"10px \"Arial\"","stroke":"none","fill":"white","font-size":18,"transform":[],"stroke-width":1}}],"rects":[{"rx":50,"ry":0,"attr":{"x":326.5,"y":43.5,"width":710,"height":50,"r":0,"rx":0,"ry":0,"fill":"red","stroke":"#000","fill-opacity":0.5,"transform":[],"stroke-width":1}}],"containers":[{"x":878.5,"y":463.5,"w":65,"h":80,"RX":602,"RY":420,"ID":"Container2","imgs":[{"rx":0,"ry":0,"attr":{"x":878.5,"y":463.5,"width":65,"height":65,"src":"img/top/switch_danger.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":911,"y":538.5,"text-anchor":"middle","text":"  危险","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",878.5,463.5],["H",943.5],["V",543.5],["H",878.5],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":878.5,"y":463.5,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":276.5,"y":463.5,"w":65,"h":80,"RX":0,"RY":420,"ID":"Container3","imgs":[{"rx":0,"ry":0,"attr":{"x":276.5,"y":463.5,"width":65,"height":65,"src":"img/top/switch_unable.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":309,"y":538.5,"text-anchor":"middle","text":"  不可用","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",276.5,463.5],["H",341.5],["V",543.5],["H",276.5],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":276.5,"y":463.5,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null}],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",276.5,43.5],["H",986.5],["V",543.5],["H",276.5],["Z"]],"stroke-width":1,"transform":[]}},"handler":{"attr":{"x":276.5,"y":43.5,"width":710,"height":50,"r":0,"rx":0,"ry":0,"fill":"green","stroke":"white","stroke-width":1,"fill-opacity":0.5,"transform":[]},"rx":0,"ry":0},"data":null},{"x":204,"y":351,"w":65,"h":100,"RX":0,"RY":0,"ID":"Container4","imgs":[{"rx":0,"ry":0,"attr":{"x":204,"y":351,"width":65,"height":65,"src":"img/top/router.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":236.5,"y":426,"text-anchor":"middle","text":"192.168.2.12","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",204,351],["H",269],["V",451],["H",204],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":204,"y":351,"width":65,"height":100,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":5814,"y":405,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container5","imgs":[{"rx":0,"ry":0,"attr":{"x":5814,"y":405,"width":65,"height":65,"src":"img/top/switch_unable.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":5846.5,"y":480,"text-anchor":"middle","text":"  不可用","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",5814,405],["H",5879],["V",485],["H",5814],["Z"]],"stroke-width":1,"transform":[]}},"handler":{"attr":{"x":5814,"y":405,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":2448.3,"y":2537.5,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container6","imgs":[{"rx":0,"ry":0,"attr":{"x":2448.3,"y":2537.5,"width":65,"height":65,"src":"img/top/router.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":2480.8,"y":2612.5,"text-anchor":"middle","text":"  路由","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",2448.3,2537.5],["H",2513.3],["V",2617.5],["H",2448.3],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":2448.3,"y":2537.5,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":5792,"y":2498,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container7","imgs":[{"rx":0,"ry":0,"attr":{"x":5792,"y":2498,"width":65,"height":65,"src":"img/top/switch_waring.png","transform":[],"stroke-width":1}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":5824.5,"y":2573,"text-anchor":"middle","text":"  警告","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[],"stroke-width":1}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",5792,2498],["H",5857],["V",2578],["H",5792],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":5792,"y":2498,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":100,"y":300,"w":70,"h":70,"RX":0,"RY":0,"ID":"Container8","imgs":[],"texts":[],"rects":[{"rx":0,"ry":0,"attr":{"x":100,"y":300,"width":70,"height":70,"r":5,"rx":5,"ry":5,"fill":"#fff","stroke":"#fff","fill-opacity":0.8,"stroke-width":1,"transform":[]}}],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",100,300],["H",170],["V",370],["H",100],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":100,"y":300,"width":70,"height":70,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":100,"y":300,"w":70,"h":70,"RX":0,"RY":0,"ID":"Container21","imgs":[],"texts":[],"rects":[{"rx":0,"ry":0,"attr":{"x":100,"y":300,"width":70,"height":70,"r":5,"rx":5,"ry":5,"fill":"#fff","stroke":"#fff","fill-opacity":0.8,"stroke-width":1,"transform":[]}}],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",100,300],["H",170],["V",370],["H",100],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":100,"y":300,"width":70,"height":70,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null}]};
//		{"lines":[{"from":"Container4","to":"Container3","ID":"Line5","attr":{"fill":"none","stroke":"white","path":[["M",269,412.78584159378386],["L",500,496.5559772296015]],"stroke-width":2,"transform":[]}},{"from":"Container3","to":"Container2","ID":"Line6","attr":{"fill":"none","stroke":"white","path":[["M",565,510],["L",1102,510]],"stroke-width":2,"transform":[]}},{"from":"Container3","to":"Container9","ID":"Line10","attr":{"fill":"none","stroke":"white","path":[["M",538.314393939394,470],["L",577.8522727272727,198]],"stroke-width":2,"transform":[]}},{"from":"Container9","to":"Container2","ID":"Line11","attr":{"fill":"none","stroke":"white","path":[["M",612,178.53286325862504],["L",1102,488.10526315789474]],"stroke-width":2,"transform":[]}},{"from":"Container2","to":"Container8","ID":"Line12","attr":{"fill":"none","stroke":"white","path":[["M",1141.2551487414187,470],["L",1166.5869565217392,320]],"stroke-width":2,"transform":[]}},{"from":"Container8","to":"Container7","ID":"Line13","attr":{"fill":"none","stroke":"white","path":[["M",1134,268.3838383838384],["L",874,175.45454545454544]],"stroke-width":2,"transform":[]}},{"from":"Container7","to":"Container3","ID":"Line14","attr":{"fill":"none","stroke":"white","path":[["M",809,201.69231319119194],["L",565,477.16691068814055]],"stroke-width":2,"transform":[]}},{"from":"Container4","to":"Container9","ID":"Line15","attr":{"fill":"none","stroke":"white","path":[["M",269,378.22747321991176],["L",547,183.43478260869566]],"stroke-width":2,"transform":[]}},{"from":"Container9","to":"Container7","ID":"Line16","attr":{"fill":"none","stroke":"white","path":[["M",612,158.85090729586437],["L",809,164.0087145969499]],"stroke-width":2,"transform":[]}},{"from":"Container7","to":"Container4","ID":"Line17","attr":{"fill":"none","stroke":"white","path":[["M",809,177.71437623084168],["L",269,388.9686274509804]],"stroke-width":2,"transform":[]}},{"from":"Container4","to":"Container8","ID":"Line18","attr":{"fill":"none","stroke":"white","path":[["M",269,396.77705014703486],["L",1134,284.3816155988858]],"stroke-width":2,"transform":[]}},{"from":"Container8","to":"Container3","ID":"Line19","attr":{"fill":"none","stroke":"white","path":[["M",1134,291.8212844981819],["L",565,498.7846961740435]],"stroke-width":2,"transform":[]}}],"containers":[{"x":500,"y":50,"w":710,"h":500,"RX":0,"RY":0,"ID":"Container1","imgs":[],"texts":[{"rx":355,"ry":25,"attr":{"x":855,"y":75,"text-anchor":"middle","text":"设备管理","font":"10px \"Arial\"","stroke":"none","fill":"white","font-size":18,"transform":[]}},{"rx":355,"ry":200,"attr":{"x":855,"y":250,"text-anchor":"middle","text":"你大爷","font":"10px \"Arial\"","stroke":"none","fill":"white","font-size":18,"transform":[]}}],"rects":[{"rx":50,"ry":0,"attr":{"x":550,"y":50,"width":710,"height":50,"r":0,"rx":0,"ry":0,"fill":"red","stroke":"#000","fill-opacity":0.5,"transform":[]}}],"containers":[{"x":1102,"y":470,"w":65,"h":80,"RX":602,"RY":470,"ID":"Container2","imgs":[{"rx":0,"ry":0,"attr":{"x":1102,"y":470,"width":65,"height":65,"src":"img/top/switch_danger.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":1134.5,"y":545,"text-anchor":"middle","text":"  危险","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",1102,470],["H",1167],["V",550],["H",1102],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":1102,"y":470,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":500,"y":470,"w":65,"h":80,"RX":0,"RY":470,"ID":"Container3","imgs":[{"rx":0,"ry":0,"attr":{"x":500,"y":470,"width":65,"height":65,"src":"img/top/switch_unable.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":532.5,"y":545,"text-anchor":"middle","text":"  不可用","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",500,470],["H",565],["V",550],["H",500],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":500,"y":470,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null}],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",500,50],["H",1210],["V",550],["H",500],["Z"]],"stroke-width":1,"transform":[]}},"handler":{"attr":{"x":500,"y":50,"width":710,"height":50,"r":0,"rx":0,"ry":0,"fill":"green","stroke":"white","stroke-width":1,"fill-opacity":0.5,"transform":[]},"rx":0,"ry":0},"data":null},{"x":204,"y":351,"w":65,"h":100,"RX":0,"RY":0,"ID":"Container4","imgs":[{"rx":0,"ry":0,"attr":{"x":204,"y":351,"width":65,"height":65,"src":"img/top/router.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":236.5,"y":426,"text-anchor":"middle","text":"192.168.2.12","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",204,351],["H",269],["V",451],["H",204],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":204,"y":351,"width":65,"height":100,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":809,"y":125,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container7","imgs":[{"rx":0,"ry":0,"attr":{"x":809,"y":125,"width":65,"height":65,"src":"img/top/switch_unable.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":841.5,"y":200,"text-anchor":"middle","text":"  不可用","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",809,125],["H",874],["V",205],["H",809],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":809,"y":125,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":1134,"y":240,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container8","imgs":[{"rx":0,"ry":0,"attr":{"x":1134,"y":240,"width":65,"height":65,"src":"img/top/router.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":1166.5,"y":315,"text-anchor":"middle","text":"  路由","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",1134,240],["H",1199],["V",320],["H",1134],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":1134,"y":240,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null},{"x":547,"y":118,"w":65,"h":80,"RX":0,"RY":0,"ID":"Container9","imgs":[{"rx":0,"ry":0,"attr":{"x":547,"y":118,"width":65,"height":65,"src":"img/top/switch_waring.png","transform":[]}}],"texts":[{"rx":32.5,"ry":75,"attr":{"x":579.5,"y":193,"text-anchor":"middle","text":"  警告","font":"10px \"Arial\"","stroke":"white","fill":"#000","transform":[]}}],"rects":[],"containers":[],"frame":{"attr":{"fill":"none","stroke":"white","path":[["M",547,118],["H",612],["V",198],["H",547],["Z"]],"stroke-width":0,"transform":[]}},"handler":{"attr":{"x":547,"y":118,"width":65,"height":80,"r":0,"rx":0,"ry":0,"fill":"#fff","stroke":"#000","stroke-width":0,"fill-opacity":0,"transform":[]},"rx":0,"ry":0},"data":null}]};
		var canvas = $("#myflow").canvas();
		canvas.setSize($(window).width(),$(window).height());	
/**		var smallCanvas = $("#myflow_props").canvas();
		smallCanvas.raphael.setSize(250,768*250/1366);
		smallCanvas.restore(rest);
		smallCanvas.setViewBox(0,0,$(window).width()*5,$(window).height()*5,false);
		smallCanvas.container(125,70,250,250).handler.attr({"fill-opacity":0.5}).drag(function(x,y,dx,dy){
			canvas.raphael.setViewBox((dx-$("#myflow_props").offset().left)*smallCanvas.coe+smallCanvas.raphael._viewBox[0]-783,(dy-$("#myflow_props").offset().top)*smallCanvas.coe+smallCanvas.raphael._viewBox[1]-384,$(document).width(),$(document).height(),false);
		},function(){
			
		},function(){
			
		})*/
		
		canvas.isEditable = true;
		canvas.restore(rest);
		canvas.container(100,300,70,70).addRect(canvas.raphael.rect(0,0,70,70,5).attr({stroke:"#fff",fill:"#fff","fill-opacity":0.8}),0,0);
		var container;
		$("#myflow_props").width(250).height(canvas.raphael.height/canvas.raphael.width*250);
		new Tiny($("#myflow_props"),canvas);
		$("#myflow_props").click(function(){ 
			return;
			smallCanvas.raphael.clear();
			$("*").css("cursor","wait");
			setTimeout(set,100);
		})
		function set(){			
			smallCanvas.restore(eval("("+canvas.getData()+")"));		 
			$("*").css("cursor","default");
			smallCanvas.container(0,0,250,250).handler.attr({"fill-opacity":0.5}).drag(function(x,y,dx,dy){				
				canvas.raphael.setViewBox((dx-$("#myflow_props").offset().left)*smallCanvas.coe+smallCanvas.raphael._viewBox[0]-768,(dy-$("#myflow_props").offset().top)*smallCanvas.coe+smallCanvas.raphael._viewBox[1]-384,$(document).width(),$(document).height(),false);
				},function(){
					
				},function(){
					
			})
		}
		$("#myflow_tools .state").each(function() {
                $(this).draggable({
					//拖拽的时候拖拽实体为克隆对象
                    helper: "clone"
                })
        });
		$("#myflow_tools").draggable({
                handle: "#myflow_tools_handle"
            }).css({left:10,top:10});
            $("#myflow_tools .node").hover(function() {
                $(this).addClass("mover")
            },
            function() {
                $(this).removeClass("mover")
        });
		$("#myflow").droppable({
                accept: ".state",
                drop: function(c, i) {
					for(var j=0;j<1;j++){
					containerJSON.containers[0].imgs[0].src = i.helper.find("img").attr("src");
					containerJSON.containers[0].texts[0].text = i.helper.text();
					//转换是为了放在视界范围内
					var transformX = i.helper.offset().left*canvas.coe+canvas.raphael._viewBox[0],
						transformY = i.helper.offset().top*canvas.coe+canvas.raphael._viewBox[1];
					canvas.container(transformX,transformY,65,80).set(containerJSON.containers[0])}
//					.addText(canvas.raphael.text(0, 0,"交换机"),55,150)
//					.addImg(canvas.raphael.image("zj2.png", 0, 0, 110, 140), 0, 0)
//					.addImg(canvas.raphael.image("start_event_empty.png", 0, 0, 40, 50), 0, 100)
//					.addImg(canvas.raphael.image("start_event_empty.png", 70, 0, 40, 50), 70, 100)					
//					.ready(0,0,110,20)
//					,i.helper.offset().left-container.x,i.helper.offset().top-container.y);
					//canvas.rect(i.helper.offset().left,i.helper.offset().top);
                }
            });
		$("#myflow_save").click(function(){
			var data = canvas.getData();
//			alert(sizeof(canvas.topContainers)+"   "+sizeof(canvas.containers));
			alert(data)
			canvas.restore(eval("("+data+")"))
		})
		var isEdit = false;
		canvas.click = function(node){
			if(node == container) return;
			if(this.clickNode != null){
				this.clickNode.frame.attr({"stroke-width":0})
				if(isEdit){
					var line = this.onLine(this.clickNode,node)
					if(line) line.animate();
				}			
			}
			node.frame.attr({"stroke-width":1})
			this.clickNode = node;
		}
		$("#path").click(function(){
			$(this).toggleClass("selected");
			isEdit = $(this).hasClass("selected");
		})
		/**
		var pper = Raphael("myflow",1000,1000);
		pper.arrow({x:200,y:200},{x:250,y:300},{x:300,y:200},{stroke:"#808080",fill:"#808080","stroke-width":"2"}).red().green()
		pper.turn();
		pper.polic(300,500,10);
		pper.polic(350,500,10);
		pper.polic(300,450,10);
		pper.polic(350,450,10);*/
	});
</script>
<style type="text/css">
body {
	margin: 0;
	pading: 0;
	text-align: left;
	font-family: Arial, sans-serif, Helvetica, Tahoma;
	font-size: 12px;
	line-height: 1.5;
	color: black;
	background-image: url(bg.png);
}

.node {
	width: 70px;
	text-align: center;
	vertical-align: middle;
	border: 1px solid #fff;
	cursor:url('img/16/gateway_parallel.png')
}

.mover {
	border: 1px solid #ddd;
	background-color: #ddd;
}

.selected {
	background-color: #ddd;
}

.state {
	
}

#myflow_props {
	position: fixed; 
	left: 5px; 
	bottom: 5px; 
	background-color:#006400;
}

#myflow_props th {
	letter-spacing: 2px;
	text-align: left;
	padding: 6px;
	background: #ddd;
}

#myflow_props td {
	background: #fff;
	padding: 6px;
}

#pointer {
	background-repeat: no-repeat;
	background-position: center;
}

#path {
	background-repeat: no-repeat;
	background-position: center;
}

#task {
	background-repeat: no-repeat;
	background-position: center;
}

#state {
	background-repeat: no-repeat;
	background-position: center;
}
</style>
</head>
<body>
<div id="myflow"></div>
<div id="myflow_tools"
	style="position: absolute; top: 10; left: 10; background-color: #fff; width: 70px; cursor: default; padding: 3px;"
	class="ui-widget-content">
<div id="myflow_tools_handle" style="text-align: center;"
	class="ui-widget-header">工具集</div>


<div class="node" id="myflow_save"><img src="img/save.gif" />&nbsp;&nbsp;保存</div>
<div>
<hr />
</div>
<div class="node selectable" id="pointer"><img
	src="img/select16.gif" />&nbsp;&nbsp;选择</div>
<div class="node selectable" id="path"><img
	src="img/16/flow_sequence.png" />&nbsp;&nbsp;连接</div>
<div>
<hr />
</div>
<div class="node state" id="start" type="start"><img
	src="img/top/router.png" width="16" height="16"/>&nbsp;&nbsp;路由</div>
<div class="node state" id="state" type="state"><img
	src="img/top/switch.png" width="16" height="16"/>&nbsp;&nbsp;交换机</div>
<div class="node state" id="task" type="task"><img
	src="img/top/switch_danger.png"  width="16" height="16"/>&nbsp;&nbsp;危险</div>
<div class="node state" id="fork" type="fork"><img
	src="img/top/switch_unable.png"  width="16" height="16"/>&nbsp;&nbsp;不可用</div>
<div class="node state" id="join" type="join"><img
	src="img/top/switch_waring.png"  width="16" height="16"/>&nbsp;&nbsp;警告</div>
<div class="node state" id="end" type="end"><img
	src="img/16/end_event_terminate.png" />&nbsp;&nbsp;结束</div>
<div class="node state" id="end-cancel" type="end-cancel"><img
	src="img/16/end_event_cancel.png" />&nbsp;&nbsp;取消</div>
<div class="node state" id="end-error" type="end-error"><img
	src="img/16/end_event_error.png" />&nbsp;&nbsp;错误</div>
</div>

<div id="myflow_props"></div>


</body>
</html>