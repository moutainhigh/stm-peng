<div class="pop-middle-l" id="sqdiv">
	<div class="pop-middle-r">
		<div class="pop-middle-m">
			<div class="pop-middle-m-content">
				<div class="pop-content">
	                <div class="license-bg panel-header">
	                    <span id="oneCenterProjectName"></span>
	                    <!-- <span class="locate-right reg_btn license-btn"><a id="restarReg" ></a></span> -->
	                </div>
					<div class="pop-con p-h">
						<ul class="license-line">
                      		<li>
                      			<!--<span class="help-t-tit">ITManager系统平台监控系统</span>-->
                      			<span class="help-t-bg">版本：</span>
                      			<span id="oneCenterProjectVersion"></span>
							</li>
                            <li>
                            	<span class="help-t-bg">授权截止日期：</span>
                            	<span id="licenseDeadLine"></span>
								<span class="reg_btn"><a id="restarReg" ></a></span>
                            </li>
								<!-- <input type="button" value="重新注册" id="restarReg" style="margin-left:350px" /> -->
							<li>
								<span class="help-t-bg">授权模块：</span>
								<div class="help-mob" id="portalModulesDiv"></div>
							</li>
							<!-- <li style="height:100px;"><span class="help-t-bg" style="position:relative; top:-70px;">授权数量</span> <div class="c-r-box help-tab">
									<table width="100%" style="text-align: center;">
										<thead class="thead-bg1">
											<tr>
												<td style="width: 25%">授权设备总数</td>
												<td style="width: 25%">资源管理设备数</td>
												<td style="width: 25%" id="vm">Esxi主机数</td>
												<td style="width: 30%">剩余授权设备数</td>
											</tr>
										</thead>
										<tbody class="common kerning01" id="monitorModulesTbody">
											<tr>
												<td><span id="totalNum"></span></td>
												<td><span id="usedNum"></span></td>
												<td><span id="vmUsedNum"></span></td>
												<td><span id="surplusNum"></span></td>
											</tr>
										</tbody>
									</table>
							</div></li> -->
							<li>
								<span class="help-t-bg">授权数量：</span> 
								<div class="c-r-box help-tab">
									<table>
										<thead class="thead-bg1">
											<tr>
												<td style="width: 17%">资源类型</td>
												<td style="width: 18%">授权数量</td>
												<td style="width: 15%">已使用</td>
												<td style="width: 17%">资源类型</td>
												<td style="width: 18%">授权数量</td>
												<td style="width: 15%">已使用</td>
											</tr>
											<tbody  class="common kerning01" id="monitorModulesTbody">
												<tr>
													<td><span>硬件设备</span></td>
													<td><span id="reshdTotalNum">0</span></td>
													<td><span id="reshdUsedNum">0</span></td>
													<td><span>宿主机</span></td>
													<td><span id="vmhostTotalNum">0</span></td>
													<td><span id="vmhostUsedNum">0</span></td>
												</tr>
												<tr>
													<td><span>软件资源</span></td>
													<td><span id="resrdTotalNum">0</span></td>
													<td><span id="resrdUsedNum">0</span></td>
													<td><span>虚拟机</span></td>
													<td><span id="vmvmTotalNum">0</span></td>
													<td><span id="vmvmUsedNum">0</span></td>
												</tr>
												<tr>
													<td><span>标准应用</span></td>
													<td><span id="appTotalNum">0</span></td>
													<td><span id="appUsedNum">0</span></td>
													<td><span>机房数</span></td>
													<td><span id="mrTotalNum">0</span></td>
													<td><span id="mrUsedNum">0</span></td>
												</tr>
												<tr>
													<td><span>存储设备</span></td>
													<td><span id="resstorTotalNum">0</span></td>
													<td><span id="resstorUsedNum">0</span></td>
													<td><span>业务系统</span></td>
													<td><span id="busiTotalNum">0</span></td>
													<td><span id="busiUsedNum">0</span></td>
												</tr>
											</tbody>
										</thead>
										<!-- <tbody class="common kerning01" id="monitorModulesTbody">
											<tr>
												<td><span id="totalNum"></span></td>
												<td><span id="usedNum"></span></td>
												<td><span id="vmUsedNum"></span></td>
												<td><span id="surplusNum"></span></td>
											</tr>
										</tbody> -->
									</table>
								</div>
							</li>
							<li>
								<span class="help-t-bg">采集器个数：</span>
								<span id="collectorCount"></span>
							</li>
						</ul>
						<ul class="help-bu">
							<!-- 
							<li>公司名称：武汉美新翔盛科技有限公司</li>
							<li>公司网址：<a style="color: #0C0;" href="http://www.v-simtone.com" target="_blank">www.mainsteam.com</a></li>
							 -->
							<li>
								<span class="help-t-bg">版权信息：</span>
								<span id="copyright"></span>
							</li>
						<!--	<li class="asline">产品名称：<span id="mainsteamProjectName"></span></li>-->
						</ul>
						<ul class="help-bu" >
							<!-- 
							<li>公司名称：武汉美新翔盛科技有限公司</li>
							<li>公司网址：<a style="color: #0C0;" href="http://www.v-simtone.com" target="_blank">www.mainsteam.com</a></li>
							 -->
							<!-- <li>产品版本：<span id="mainsteamProjectVersion"></span></li>-->
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
$(function(){

	oc.util.ajax({
		url:oc.resource.getUrl("system/license/getLicense.htm"),
		success:function(d){
			if(d && d.code==200){
				var lic = d.data;
				if(lic){
					$("#licenseDeadLine").text(new Date(lic.deadLine).stringify("yyyy-mm-dd"));
					var deadline = $("#licenseDeadLine").val();
					var modules = lic.portalModules;
					var monitorModule = lic.monitorModule;
					var collector = lic.collector;
					var vmComputerMode=lic.vmComputerMode;
					var licenseUseInfoBos = lic.licenseUseInfoBo;
					var zjnum=0;
					if(modules && modules.length>0){
						var html ="";
						for(var i=0;i<modules.length;i++){
							var modul = modules[i];
							var checked = modul.author?'checked="checked"':'';
							html+='<span class="m-r-40"><input type="checkbox" class="oc-checkbox-locate" '+checked+' disabled="disabled"><span class="w-100">'+modul.name+'</span></span>';
						}
						$(html).appendTo($("#portalModulesDiv"));
					}
					if(vmComputerMode==undefined || vmComputerMode==0){//exit主机数
						zjnum=(monitorModule.vmUsedCount / 10) + ' * 10';
					}else{
						zjnum=	monitorModule.vmUsedCount;
						$("#vm").text('虚拟机数');sc
					}
//					console.log(lic.licenseUseInfoBo);
					if(lic.licenseUseInfoBo){
						for(var i=0;i<lic.licenseUseInfoBo.length;i++){
//							if(lic.licenseUseInfoBo[i].lmEnum=="oc4-num-busi"){
//								dlg.find("#monitorModulesTbody #busiTaotalNum").text(lic.licenseUseInfoBo[i].authorCount);
//								dlg.find("#monitorModulesTbody #busiUsedNum").text(lic.licenseUseInfoBo[i].usedCount);
//							}
							var lmEnmu=lic.licenseUseInfoBo[i].lmEnum;
							var authorCount=lic.licenseUseInfoBo[i].authorCount;
							var usedCount=lic.licenseUseInfoBo[i].usedCount;
							switch(lmEnmu){
							case "oc4-num-res-hd":
								$("#monitorModulesTbody #reshdTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #reshdUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-res-rd":
								$("#monitorModulesTbody #resrdTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #resrdUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-res-stor":
								$("#monitorModulesTbody #resstorTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #resstorUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-topo-mr":
								$("#monitorModulesTbody #mrTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #mrUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-vm-host":
								$("#monitorModulesTbody #vmhostTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #vmhostUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-vm-vm":
								$("#monitorModulesTbody #vmvmTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #vmvmUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-res-app":
								$("#monitorModulesTbody #appTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #appUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							case "oc4-num-busi":
								$("#monitorModulesTbody #busiTotalNum").text(authorCount!=0?authorCount:'0');
								$("#monitorModulesTbody #busiUsedNum").text(authorCount!=0?usedCount:'0');
								break;
							}
						}
					}
					
					if(monitorModule){
						$("#monitorModulesTbody #totalNum").text(monitorModule.authorCount);
						$("#monitorModulesTbody #usedNum").text(monitorModule.usedCount);
						$("#monitorModulesTbody #vmUsedNum").text(zjnum);
						if(monitorModule.remainCount>0){
							$("#monitorModulesTbody #surplusNum").text(monitorModule.remainCount);
						}else{
							$("#monitorModulesTbody #surplusNum").text(0);
							$("#monitorModulesTbody #surplusNum").css("color","red");
							
						}
					}
					
					if(collector){
						//采集器不能为0；
						$("#collectorCount").text(collector.count<1?1:collector.count);
					}
					$("#copyright").text(lic.copyright.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&copy;/g,"©"));
					$("#oneCenterProjectName").text(lic.productName);
					$("#oneCenterProjectVersion").text(lic.version);
					$("#restarReg").linkbutton('RenderLB',{
						text:'重新注册',
					//	iconCls:"icon-edit",
						onClick:function(){
							var reg = $('<div/>');
							reg.dialog({
								href : oc.resource.getUrl('resource/license-active.html'),
								title : '重新注册',
								width:550,
								height : 300,
								resizable : false,
								cache : false, 
								onLoad:function(){
								}			 
							 });
						}
					});
					
				}
				
				
			}
			
			
		}
	});
	
	
});




</script>